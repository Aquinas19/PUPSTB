<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COMP 001: Introduction to Computing Mastery Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&family=Poppins:wght@400;600&family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --pup-maroon: #800000;
            --pup-gold: #D4AF37;
            --bg-light: #f8fafc;
            --text-dark: #1e293b;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Timer Styles */
        .timer-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: var(--pup-maroon);
            color: white;
            padding: 10px 0;
            text-align: center;
            font-weight: bold;
            z-index: 1100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-family: 'Fira Code', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            visibility: hidden; 
        }
        #timeDisplay { font-size: 20px; color: var(--pup-gold); }

        .quiz-container {
            max-width: 900px;
            width: 100%;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-top: 10px solid var(--pup-maroon);
            margin-top: 50px;
            filter: blur(15px); 
            transition: filter 0.5s ease;
            pointer-events: none; 
        }

        .quiz-container.started {
            filter: blur(0);
            pointer-events: auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
        }

        h1 { color: var(--pup-maroon); font-family: 'Poppins', sans-serif; margin: 0; font-size: 28px; }
        .subtitle { color: var(--pup-gold); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; font-size: 14px; }

        .student-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            background: #fffaf1;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #ffe4b3;
        }

        .input-group { display: flex; flex-direction: column; gap: 5px; }
        .input-group.full-width { grid-column: span 2; }
        label { font-weight: bold; font-size: 14px; }
        input[type="text"], input[type="password"], textarea {
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-family: inherit;
        }

        .section-title {
            background: var(--pup-maroon);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            margin-top: 40px;
            font-family: 'Poppins', sans-serif;
        }

        .question-card {
            margin: 25px 0;
            padding: 20px;
            border-bottom: 1px solid #f1f5f9;
        }

        .question-text { font-weight: 600; font-size: 18px; margin-bottom: 15px; display: block; }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .option-label {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
        }
        .option-label:hover { background: #fdf2f2; border-color: var(--pup-maroon); }
        input[type="radio"] { accent-color: var(--pup-maroon); }

        .fill-input { width: 100%; max-width: 400px; border-bottom: 2px solid var(--pup-gold) !important; border-top:none; border-left:none; border-right:none; border-radius: 0; outline: none; background: transparent; }

        .code-area {
            width: 100%;
            height: 100px;
            background: #f1f5f9;
            color: var(--text-dark);
            font-family: 'Poppins', sans-serif;
            padding: 15px;
            border-radius: 8px;
            resize: vertical;
            border: 1px solid #cbd5e1;
        }

        .footer-actions {
            margin-top: 50px;
            text-align: center;
            padding-top: 30px;
            border-top: 2px solid #eee;
        }

        .submit-btn {
            background: var(--pup-maroon);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(128, 0, 0, 0.3);
            transition: 0.3s;
        }

        .submit-btn:hover { transform: scale(1.05); background: #600000; }

        .progress-bar {
            position: fixed;
            top: 45px;
            left: 0;
            height: 4px;
            background: var(--pup-gold);
            width: 0%;
            z-index: 1100;
            transition: 0.3s;
            visibility: hidden;
        }

        #blockade, #startModal, #adminModal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.98);
            z-index: 2000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }

        #adminModal { background: rgba(0,0,0,0.7); z-index: 3000; }
        #startModal { background: rgba(248, 250, 252, 0.95); }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-top: 8px solid var(--pup-maroon);
        }

        .modal-buttons { display: flex; gap: 15px; margin-top: 30px; justify-content: center; }
        
        .modal-btn {
            padding: 12px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            border: none;
            font-size: 16px;
            transition: 0.2s;
        }
        .btn-confirm { background: var(--pup-maroon); color: white; }
        .btn-confirm:hover { background: #600000; transform: translateY(-2px); }
        .btn-cancel { background: #e2e8f0; color: var(--text-dark); }
        .btn-cancel:hover { background: #cbd5e1; }

        .admin-link {
            margin-top: 40px;
            font-size: 11px;
            color: #94a3b8;
            background: none;
            border: 1px solid #e2e8f0;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        .admin-link:hover { color: var(--pup-maroon); border-color: var(--pup-maroon); }

        @media (max-width: 600px) {
            .student-info { grid-template-columns: 1fr; }
            .input-group.full-width { grid-column: span 1; }
            .options-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="timer-bar" id="timerBar">
    <span><i class="fa-solid fa-clock"></i> TIME REMAINING:</span>
    <span id="timeDisplay">04:00:00</span>
</div>
<div class="progress-bar" id="progressBar"></div>

<!-- Start Exam Modal -->
<div id="startModal" style="display: flex;">
    <div class="modal-content">
        <i class="fa-solid fa-microchip" style="font-size: 60px; color: var(--pup-maroon); margin-bottom: 20px;"></i>
        <h2>COMP 001: Mastery Quiz</h2>
        <p style="color: #64748b; line-height: 1.6;">
            Ready to begin the <strong>Introduction to Computing</strong> Quiz?<br>
            You have <strong>4 hours</strong> to complete all 55 items. 
            The timer begins the moment you click Start.
        </p>
        <div class="modal-buttons">
            <button class="modal-btn btn-cancel" onclick="exitExam()">Close</button>
            <button class="modal-btn btn-confirm" onclick="startExam()">Start Exam</button>
        </div>
    </div>
</div>

<!-- Access Blocked Message -->
<div id="blockade">
    <i class="fa-solid fa-user-lock" style="font-size: 80px; color: var(--pup-maroon); margin-bottom: 20px;"></i>
    <h1 style="color: var(--pup-maroon);">Session Locked</h1>
    <p style="font-size: 18px; max-width: 600px;">
        This quiz instance has already been submitted or expired. 
        Multiple attempts are restricted.
    </p>
    <button class="admin-link" onclick="showAdminModal()">Admin Reset Instance</button>
</div>

<!-- Admin PIN Modal -->
<div id="adminModal">
    <div class="modal-content">
        <h2>Administrator Access</h2>
        <p>Enter Admin PIN to reset instance:</p>
        <input type="password" id="adminPinInput" placeholder="Enter PIN..." style="width: 100%; margin-bottom: 10px;">
        <div class="modal-buttons">
            <button class="modal-btn btn-cancel" onclick="closeAdminModal()">Cancel</button>
            <button class="modal-btn btn-confirm" onclick="verifyAdminPin()">Reset Now</button>
        </div>
    </div>
</div>

<div class="quiz-container" id="mainQuiz">
    <header>
        <h1>COMP 001: Introduction to Computing Mastery Quiz</h1>
        <p class="subtitle">College of Computer and Information Sciences</p>
    </header>

    <div class="student-info">
        <div class="input-group full-width">
            <label>Full Name:</label>
            <input type="text" id="studentName" placeholder="Surname, First Name M.I.">
        </div>
        <div class="input-group">
            <label>Student Number:</label>
            <input type="text" id="studentNumber" placeholder="20XX-XXXXX-MN-0">
        </div>
        <div class="input-group">
            <label>Section:</label>
            <input type="text" id="studentSection" placeholder="e.g., BSIT 1-1">
        </div>
    </div>

    <form id="quizForm">
        <!-- PART I: MULTIPLE CHOICE -->
        <h2 class="section-title">Part I: Multiple Choice (1-25)</h2>
        <div id="mcqContainer"></div>

        <!-- PART II: COMPLETION -->
        <h2 class="section-title">Part II: Fill in the Blanks (26-40)</h2>
        <div id="completionContainer"></div>

        <!-- PART III: IDENTIFICATION & ANALYSIS -->
        <h2 class="section-title">Part III: Identification & Analysis (41-55)</h2>
        <div id="codingContainer"></div>
    </form>

    <div class="footer-actions">
        <p style="font-size: 14px; color: #64748b; margin-bottom: 20px;">
            Submit your finalized answers. A .doc file will be generated. 
            Email the file to <strong>jbpenalosa@pup.edu.ph</strong>.
        </p>
        <button type="button" class="submit-btn" id="exportBtn" onclick="generateSubmission()">
            <i class="fa-solid fa-file-export"></i> Finalize & Export Submission (.doc)
        </button>
        <br>
        <button class="admin-link" onclick="showAdminModal()">Admin Reset Instance</button>
    </div>
</div>

<script>
    const mcqQuestions = [
        { q: "What is the collective term for raw facts, text, or graphics that lack context?", options: ["Data", "Information"] },
        { q: "Which element of a computer consists of intangible instructions?", options: ["Hardware", "Software"] },
        { q: "Without which element does hardware remain dormant and software remain unwritten?", options: ["Peopleware", "Firmware"] },
        { q: "Who invented the World Wide Web in 1989?", options: ["Sir Tim Berners-Lee", "Alan Turing"] },
        { q: "In Cloud Computing, subscriptions like Microsoft 365 fall under:", options: ["SaaS", "IaaS"] },
        { q: "What does a DoS attack stand for?", options: ["Denial of Service", "Data of System"] },
        { q: "Data that has been processed and structured for decision making is called:", options: ["Information", "Big Data"] },
        { q: "What technology embeds sensors in physical objects to exchange data over the internet?", options: ["Internet of Things (IoT)", "Cloud Computing"] },
        { q: "What security safeguard acts as bait for intruders by appearing vulnerable?", options: ["Honeypot", "Firewall"] },
        { q: "Which of the following is a simulation of human intelligence in machines?", options: ["Artificial Intelligence", "Big Data Analytics"] },
        { q: "Who is known for the Turing Test and as a godfather of AI?", options: ["Alan Turing", "John McCarthy"] },
        { q: "Which protocol is used for retrieving web pages?", options: ["HTTP", "URL"] },
        { q: "What is the standard formatting language for web pages?", options: ["HTML", "C++"] },
        { q: "What provides a unique address for every resource on the web?", options: ["URL/URI", "HTTP"] },
        { q: "Which safeguard screens incoming and outgoing network messages?", options: ["Firewall", "Antivirus"] },
        { q: "Which attack hides as legitimate software but causes data theft?", options: ["Trojan", "Worm"] },
        { q: "Which malware replicates across networks using up system resources?", options: ["Worm", "Virus"] },
        { q: "AI learning where desired outputs are provided by a teacher is:", options: ["Supervised", "Unsupervised"] },
        { q: "What is the main circuit board of a computer called?", options: ["Motherboard", "CPU"] },
        { q: "Which component is considered the 'brain' of the computer?", options: ["CPU", "RAM"] },
        { q: "What type of storage is temporary and volatile?", options: ["RAM", "SSD"] },
        { q: "Which software category includes the Operating System?", options: ["System Software", "Application Software"] },
        { q: "Photoshop and MS Word are examples of:", options: ["Application Software", "Utility Software"] },
        { q: "The process of transforming data into information is the:", options: ["Data Processing Cycle", "IPO Flow"] },
        { q: "Which cloud model provides servers and networks as infrastructure?", options: ["IaaS", "PaaS"] }
    ];

    const fillQuestions = [
        "26. The acronym WWW stands for:",
        "27. Cloud model that provides platforms for development tools:",
        "28. Malware that infects and spreads but needs human action to replicate:",
        "29. Safeguard that uses virus signatures to quarantine files:",
        "30. Data that has meaning and context is:",
        "31. The tangible, physical machinery of a computer:",
        "32. The 'I' in ICT stands for:",
        "33. An attack that floods a network to disrupt access:",
        "34. AI Godfather who coined the term 'Artificial Intelligence':",
        "35. Consortium that sets standards for the Web:",
        "36. Software used to detect system breaches:",
        "37. The 'Input' that often lacks context on its own:",
        "38. Unique address of a web resource:",
        "39. AI model that learns from data without labels:",
        "40. Part of a computer system: Hardware, Software, and ____:"
    ];

    const codingQuestions = [
        "41. Identify whether coordinates 14.12, 121.22 are Data or Information.",
        "42. A weather report says 'Temp: 32Â°C'. Is this Data or Information?",
        "43. Which computer element serves as the bridge between Hardware and Peopleware?",
        "44. If a network is inaccessible due to high traffic flooding, what attack is likely?",
        "45. A user buys a Netflix subscription. What cloud model is being used?",
        "46. Name the language used to structure the text on a website.",
        "47. Identify the security safeguard that prevents unauthorized access by screening packets.",
        "48. An AI identifies cat pictures without being told what a cat is. Type of learning?",
        "49. Protocol used when your browser 'GETs' an image from a server.",
        "50. A dummy server used to monitor hacker behavior.",
        "51. First stage of the Data Processing Cycle.",
        "52. Hardware component used for long-term data storage.",
        "53. Briefly explain why a list of numbers is 'Data' but an average grade is 'Information'.",
        "54. In your own words, why can software not exist without Peopleware?",
        "55. Name the safeguard that inoculates files based on known virus signatures."
    ];

    const QUIZ_DURATION_MS = 4 * 60 * 60 * 1000;
    let timerInterval;

    window.onload = () => {
        initQuizUI();

        if (localStorage.getItem('quiz_completed') === 'true') {
            blockAccess();
            return;
        }

        let startTime = localStorage.getItem('quiz_start_time');
        if (startTime) {
            document.getElementById('startModal').style.display = 'none';
            resumeExam(parseInt(startTime));
        } else {
            document.getElementById('startModal').style.display = 'flex';
        }
    };

    function initQuizUI() {
        const mcqCont = document.getElementById('mcqContainer');
        mcqQuestions.forEach((q, i) => {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.innerHTML = `
                <span class="question-text">${i + 1}. ${q.q}</span>
                <div class="options-grid">
                    ${q.options.map(opt => `
                        <label class="option-label">
                            <input type="radio" name="q${i+1}" value="${opt}"> ${opt}
                        </label>
                    `).join('')}
                </div>
            `;
            mcqCont.appendChild(card);
        });

        const fillCont = document.getElementById('completionContainer');
        fillQuestions.forEach((q, i) => {
            const num = i + 26;
            const card = document.createElement('div');
            card.className = 'question-card';
            card.innerHTML = `
                <span class="question-text">${q}</span>
                <input type="text" name="q${num}" class="fill-input" placeholder="Enter identification...">
            `;
            fillCont.appendChild(card);
        });

        const codeCont = document.getElementById('codingContainer');
        codingQuestions.forEach((q, i) => {
            const num = i + 41;
            const card = document.createElement('div');
            card.className = 'question-card';
            card.innerHTML = `
                <span class="question-text">${q}</span>
                <textarea name="q${num}" class="code-area" placeholder="Type your answer or analysis..."></textarea>
            `;
            codeCont.appendChild(card);
        });

        document.addEventListener('change', updateProgress);
        document.addEventListener('input', updateProgress);
    }

    function startExam() {
        const startTime = Date.now();
        localStorage.setItem('quiz_start_time', startTime);
        document.getElementById('startModal').style.display = 'none';
        resumeExam(startTime);
    }

    function resumeExam(startTime) {
        document.getElementById('mainQuiz').classList.add('started');
        document.getElementById('timerBar').style.visibility = 'visible';
        document.getElementById('progressBar').style.visibility = 'visible';
        startTimer(startTime);
    }

    function exitExam() {
        if(confirm("Exit the exam? Progress will not be saved if you close this tab without starting.")) {
            document.body.innerHTML = "<div style='height:100vh; display:flex; justify-content:center; align-items:center;'><h1>Quiz Terminated.</h1></div>";
        }
    }

    function startTimer(startTime) {
        const timerElement = document.getElementById('timeDisplay');
        timerInterval = setInterval(() => {
            const now = Date.now();
            const remaining = QUIZ_DURATION_MS - (now - startTime);

            if (remaining <= 0) {
                clearInterval(timerInterval);
                timerElement.innerText = "00:00:00";
                autoSubmit();
                return;
            }

            const h = Math.floor(remaining / 3600000).toString().padStart(2, '0');
            const m = Math.floor((remaining % 3600000) / 60000).toString().padStart(2, '0');
            const s = Math.floor((remaining % 60000) / 1000).toString().padStart(2, '0');
            timerElement.innerText = `${h}:${m}:${s}`;
            if (remaining < 300000) timerElement.style.color = "#ff4d4d";
        }, 1000);
    }

    function blockAccess() {
        document.getElementById('startModal').style.display = 'none';
        document.getElementById('mainQuiz').style.display = 'none';
        document.getElementById('blockade').style.display = 'flex';
        document.getElementById('timerBar').style.display = 'none';
        document.getElementById('progressBar').style.display = 'none';
    }

    function showAdminModal() {
        document.getElementById('adminModal').style.display = 'flex';
        document.getElementById('adminPinInput').value = "";
        document.getElementById('adminPinInput').focus();
    }

    function closeAdminModal() { document.getElementById('adminModal').style.display = 'none'; }

    function verifyAdminPin() {
        if (document.getElementById('adminPinInput').value === "PUP_ADMIN_RESET") {
            localStorage.removeItem('quiz_start_time');
            localStorage.removeItem('quiz_completed');
            location.reload();
        } else { alert("Incorrect PIN."); }
    }

    function updateProgress() {
        const total = 55;
        let filled = 0;
        document.querySelectorAll('input[type="radio"]:checked').forEach(() => filled++);
        document.querySelectorAll('.fill-input').forEach(i => { if(i.value.trim()) filled++; });
        document.querySelectorAll('.code-area').forEach(i => { if(i.value.trim()) filled++; });
        document.getElementById('progressBar').style.width = (filled / total) * 100 + "%";
    }

    function autoSubmit() {
        // Force the download immediately to capture partial progress
        generateSubmission(true);
    }

    function generateSubmission(isAuto = false) {
        const name = document.getElementById('studentName').value.trim();
        const section = document.getElementById('studentSection').value.trim();
        const studNo = document.getElementById('studentNumber').value.trim();

        if(!isAuto && (!name || !section)) {
            alert("Name and Section are required."); return;
        }

        let content = `
        <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
        <head><meta charset='utf-8'></head>
        <body style="font-family: Arial;">
            <h1>COMP 001: MASTERY QUIZ SUBMISSION</h1>
            <p style="color: red;">${isAuto ? "<strong>[SYSTEM NOTICE: AUTO-SUBMITTED UPON TIME EXPIRY]</strong>" : ""}</p>
            <p><strong>STUDENT:</strong> ${name || "N/A"}</p>
            <p><strong>STUDENT NO:</strong> ${studNo || "N/A"}</p>
            <p><strong>SECTION:</strong> ${section || "N/A"}</p>
            <p><strong>DATE:</strong> ${new Date().toLocaleString()}</p>
            <hr/>
            <h3>ANSWERS CAPTURED</h3>`;

        const form = document.getElementById('quizForm');
        for(let i = 1; i <= 55; i++) {
            let val = "";
            if(i <= 25) {
                const radio = form.querySelector(`input[name="q${i}"]:checked`);
                val = radio ? radio.value : "[NO ANSWER PROVIDED]";
            } else if(i <= 40) {
                val = form.querySelector(`input[name="q${i}"]`).value.trim() || "[NO ANSWER PROVIDED]";
            } else {
                val = form.querySelector(`textarea[name="q${i}"]`).value.trim() || "[NO ANSWER PROVIDED]";
            }
            content += `<p><strong>Item ${i}:</strong> ${val}</p>`;
        }
        content += `</body></html>`;

        const blob = new Blob([content], { type: 'application/msword' });
        const a = document.createElement('a');
        
        // Use placeholder names if empty during auto-submission
        const fileNameBase = (name || "INCOMPLETE_STUDENT").replace(/\s+/g, '_');
        const sectionBase = (section || "INCOMPLETE_SECTION").replace(/\s+/g, '_');
        const fileName = `${fileNameBase}_${sectionBase}.doc`;
        
        a.download = fileName;
        a.href = URL.createObjectURL(blob);
        document.body.appendChild(a);
        a.click();
        
        localStorage.setItem('quiz_completed', 'true');
        blockAccess();
        
        if(!isAuto) {
            alert("Export complete. Email this file to jbpenalosa@pup.edu.ph");
        } else {
            alert("TIME EXPIRED. Your partial progress has been automatically downloaded. Please check your downloads folder and email the file to jbpenalosa@pup.edu.ph");
        }
    }
</script>

</body>
</html>